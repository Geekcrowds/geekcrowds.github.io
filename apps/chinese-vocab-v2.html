<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±‰è¯­å® V2 - ä¸­æ–‡è¯æ±‡å­¦ä¹ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
        }

        .chinese-text {
            font-family: 'Noto Sans SC', sans-serif;
        }

        /* Flip Card Animation */
        .flip-card {
            perspective: 1000px;
            cursor: pointer;
        }

        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 1rem;
        }

        .flip-card-back {
            transform: rotateY(180deg);
        }

        /* Confetti Animation */
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            z-index: 1000;
            animation: confetti-fall 3s linear forwards;
        }

        /* Smooth Transitions */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Character Animation */
        .char-pop {
            animation: charPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes charPop {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        /* Quiz option hover effect */
        .quiz-option {
            transition: all 0.2s ease;
        }
        .quiz-option:hover:not(.correct-answer):not(.wrong-answer) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .correct-answer {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            animation: pulse 0.5s ease;
            color: white !important;
        }

        .wrong-answer {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
            animation: shake 0.5s ease;
            color: white !important;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Mode selector */
        .mode-badge {
            transition: all 0.3s ease;
        }

        .mode-badge.active {
            transform: scale(1.05);
        }

        /* Pinyin tone colors */
        .tone-1 { color: #ef4444; } /* red - flat */
        .tone-2 { color: #f59e0b; } /* amber - rising */
        .tone-3 { color: #10b981; } /* green - dipping */
        .tone-4 { color: #3b82f6; } /* blue - falling */
        .tone-5 { color: #6b7280; } /* gray - neutral */
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50 min-h-screen">

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        
        <!-- Header -->
        <header class="text-center mb-8">
            <div class="inline-block">
                <h1 class="text-5xl font-black chinese-text mb-2 bg-gradient-to-r from-purple-600 via-pink-600 to-blue-600 bg-clip-text text-transparent">
                    æ±‰è¯­å® V2
                </h1>
                <p class="text-gray-600 text-sm mb-2">æ‹¼éŸ³ â‡„ æ±‰å­—åŒå‘å­¦ä¹  Â· Chinese-Pinyin Learning</p>
                <div class="flex gap-2 justify-center items-center text-xs text-gray-500">
                    <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded">âœ¨ çœ‹æ‹¼éŸ³è®¤æ±‰å­—</span>
                    <span class="px-2 py-1 bg-pink-100 text-pink-700 rounded">âœ¨ çœ‹æ±‰å­—è®¤æ‹¼éŸ³</span>
                    <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded">âœ¨ çœ‹æ±‰å­—è®¤è‹±æ–‡</span>
                </div>
            </div>
        </header>

        <!-- Stats Bar -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                <div class="text-gray-500 text-xs font-medium mb-1">ä»Šæ—¥å­¦ä¹ </div>
                <div class="text-2xl font-bold text-purple-600" id="todayCount">0</div>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                <div class="text-gray-500 text-xs font-medium mb-1">å·²æŒæ¡</div>
                <div class="text-2xl font-bold text-green-600" id="masteredCount">0</div>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                <div class="text-gray-500 text-xs font-medium mb-1">è¿ç»­æ‰“å¡</div>
                <div class="text-2xl font-bold text-orange-600" id="streakCount">0</div>
            </div>
            <div class="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                <div class="text-gray-500 text-xs font-medium mb-1">æ€»è¯æ±‡é‡</div>
                <div class="text-2xl font-bold text-blue-600" id="totalCount">50</div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 mb-6 p-2">
            <div class="flex gap-2">
                <button onclick="switchTab('learn')" id="tab-learn" class="flex-1 px-6 py-3 rounded-lg font-medium transition-all bg-gradient-to-r from-purple-600 to-pink-600 text-white">
                    <i class="fas fa-book-open mr-2"></i>å­¦ä¹ å¡ç‰‡
                </button>
                <button onclick="switchTab('quiz')" id="tab-quiz" class="flex-1 px-6 py-3 rounded-lg font-medium transition-all text-gray-600 hover:bg-gray-50">
                    <i class="fas fa-question-circle mr-2"></i>è¶£å‘³æµ‹éªŒ
                </button>
                <button onclick="switchTab('stats')" id="tab-stats" class="flex-1 px-6 py-3 rounded-lg font-medium transition-all text-gray-600 hover:bg-gray-50">
                    <i class="fas fa-chart-bar mr-2"></i>å­¦ä¹ ç»Ÿè®¡
                </button>
            </div>
        </div>

        <!-- HSK Level Filter -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6">
            <div class="flex flex-wrap items-center gap-3">
                <span class="text-sm font-medium text-gray-600">HSKç­‰çº§ï¼š</span>
                <button onclick="filterByHSK('all')" class="hsk-filter px-4 py-2 rounded-lg text-sm font-medium transition-all bg-purple-100 text-purple-700" data-level="all">
                    å…¨éƒ¨
                </button>
                <button onclick="filterByHSK('1')" class="hsk-filter px-4 py-2 rounded-lg text-sm font-medium transition-all bg-gray-100 text-gray-600" data-level="1">
                    HSK 1
                </button>
                <button onclick="filterByHSK('2')" class="hsk-filter px-4 py-2 rounded-lg text-sm font-medium transition-all bg-gray-100 text-gray-600" data-level="2">
                    HSK 2
                </button>
                <button onclick="filterByHSK('3')" class="hsk-filter px-4 py-2 rounded-lg text-sm font-medium transition-all bg-gray-100 text-gray-600" data-level="3">
                    HSK 3
                </button>
                <button onclick="filterByHSK('4')" class="hsk-filter px-4 py-2 rounded-lg text-sm font-medium transition-all bg-gray-100 text-gray-600" data-level="4">
                    HSK 4
                </button>
            </div>
        </div>

        <!-- Learning Section -->
        <section id="learn-section" class="fade-in">
            <!-- Flash Card -->
            <div class="max-w-2xl mx-auto">
                <div class="flip-card h-96 mb-6" id="flashCard" onclick="flipCard()">
                    <div class="flip-card-inner h-full">
                        <!-- Front -->
                        <div class="flip-card-front bg-white shadow-xl p-8 flex flex-col items-center justify-center">
                            <div class="text-8xl mb-4 chinese-text char-pop" id="cardCharacter">ä½ å¥½</div>
                            <div class="text-2xl text-gray-600 mb-2" id="cardPinyin">nÇ hÇo</div>
                            <div class="text-sm text-gray-400">ç‚¹å‡»ç¿»è½¬æŸ¥çœ‹å«ä¹‰</div>
                        </div>
                        <!-- Back -->
                        <div class="flip-card-back bg-gradient-to-br from-purple-500 to-pink-500 text-white shadow-xl p-8 flex flex-col justify-center">
                            <div class="text-3xl font-bold mb-4" id="cardEnglish">Hello</div>
                            <div class="text-lg mb-4 chinese-text" id="cardExample">ä½ å¥½ï¼å¾ˆé«˜å…´è§åˆ°ä½ ã€‚</div>
                            <div class="text-sm opacity-90" id="cardExampleEn">Hello! Nice to meet you.</div>
                            <div class="mt-6 pt-6 border-t border-white/30">
                                <div class="text-sm opacity-75">HSK <span id="cardHSK">1</span> Â· <span id="cardCategory">é—®å€™</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card Controls -->
                <div class="flex gap-4 justify-center mb-8">
                    <button onclick="markDifficult()" class="px-8 py-4 bg-red-500 hover:bg-red-600 text-white rounded-xl font-medium shadow-lg transition-all transform hover:scale-105">
                        <i class="fas fa-times mr-2"></i>ä¸è®¤è¯†
                    </button>
                    <button onclick="markKnown()" class="px-8 py-4 bg-green-500 hover:bg-green-600 text-white rounded-xl font-medium shadow-lg transition-all transform hover:scale-105">
                        <i class="fas fa-check mr-2"></i>è®¤è¯†
                    </button>
                </div>

                <!-- Progress Bar -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex justify-between text-sm text-gray-600 mb-2">
                        <span>ä»Šæ—¥è¿›åº¦</span>
                        <span><span id="currentProgress">0</span> / <span id="dailyGoal">20</span></span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div id="progressBar" class="bg-gradient-to-r from-purple-600 to-pink-600 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quiz Section -->
        <section id="quiz-section" class="hidden">
            <div class="max-w-2xl mx-auto">
                
                <!-- Quiz Mode Selector -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 mb-6">
                    <div class="text-sm font-medium text-gray-600 mb-3 text-center">é€‰æ‹©æµ‹éªŒæ¨¡å¼</div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                        <button onclick="setQuizMode('pinyin-to-char')" id="mode-pinyin-to-char" class="mode-badge p-4 rounded-xl border-2 border-purple-200 bg-purple-50 text-purple-700 font-medium transition-all active">
                            <i class="fas fa-language mr-2"></i>
                            <div class="text-sm">çœ‹æ‹¼éŸ³é€‰æ±‰å­—</div>
                            <div class="text-xs opacity-75 mt-1">Pinyin â†’ æ±‰å­—</div>
                        </button>
                        <button onclick="setQuizMode('char-to-pinyin')" id="mode-char-to-pinyin" class="mode-badge p-4 rounded-xl border-2 border-gray-200 bg-gray-50 text-gray-600 font-medium transition-all hover:border-pink-200 hover:bg-pink-50">
                            <i class="fas fa-spell-check mr-2"></i>
                            <div class="text-sm">çœ‹æ±‰å­—é€‰æ‹¼éŸ³</div>
                            <div class="text-xs opacity-75 mt-1">æ±‰å­— â†’ Pinyin</div>
                        </button>
                        <button onclick="setQuizMode('char-to-english')" id="mode-char-to-english" class="mode-badge p-4 rounded-xl border-2 border-gray-200 bg-gray-50 text-gray-600 font-medium transition-all hover:border-blue-200 hover:bg-blue-50">
                            <i class="fas fa-globe mr-2"></i>
                            <div class="text-sm">çœ‹æ±‰å­—é€‰è‹±æ–‡</div>
                            <div class="text-xs opacity-75 mt-1">æ±‰å­— â†’ English</div>
                        </button>
                    </div>
                </div>

                <!-- Quiz Card -->
                <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
                    <div class="text-center mb-2">
                        <div class="inline-block px-4 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium mb-4" id="quizModeLabel">
                            çœ‹æ‹¼éŸ³é€‰æ±‰å­—
                        </div>
                    </div>
                    
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4 chinese-text" id="quizQuestion">xuÃ©xÃ­</div>
                        <div class="text-sm text-gray-400" id="quizHint">è¯·é€‰æ‹©æ­£ç¡®çš„æ±‰å­—</div>
                    </div>

                    <!-- Quiz Options -->
                    <div class="grid grid-cols-1 gap-3" id="quizOptions">
                        <!-- Options will be injected by JS -->
                    </div>
                </div>

                <!-- Quiz Stats -->
                <div class="grid grid-cols-3 gap-4">
                    <div class="bg-white rounded-xl p-4 text-center shadow-sm">
                        <div class="text-2xl font-bold text-green-600" id="quizCorrect">0</div>
                        <div class="text-xs text-gray-500">ç­”å¯¹</div>
                    </div>
                    <div class="bg-white rounded-xl p-4 text-center shadow-sm">
                        <div class="text-2xl font-bold text-red-600" id="quizWrong">0</div>
                        <div class="text-xs text-gray-500">ç­”é”™</div>
                    </div>
                    <div class="bg-white rounded-xl p-4 text-center shadow-sm">
                        <div class="text-2xl font-bold text-blue-600" id="quizAccuracy">0%</div>
                        <div class="text-xs text-gray-500">æ­£ç¡®ç‡</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats Section -->
        <section id="stats-section" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Learning Progress Chart -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-bold mb-4 text-gray-800">å­¦ä¹ è¿›åº¦</h3>
                    <div class="h-64">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>

                <!-- HSK Distribution -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-bold mb-4 text-gray-800">HSKç­‰çº§åˆ†å¸ƒ</h3>
                    <div class="h-64">
                        <canvas id="hskChart"></canvas>
                    </div>
                </div>

                <!-- Quiz Mode Performance -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-bold mb-4 text-gray-800">æµ‹éªŒæ¨¡å¼è¡¨ç°</h3>
                    <div class="h-64">
                        <canvas id="modeChart"></canvas>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-bold mb-4 text-gray-800">æœ€è¿‘å­¦ä¹ </h3>
                    <div id="recentActivity" class="space-y-3 max-h-64 overflow-y-auto">
                        <!-- Activity items will be injected -->
                    </div>
                </div>
            </div>
        </section>

    </div>

    <script>
        // Vocabulary Data - 50 common Chinese words
        const vocabulary = [
            // HSK 1
            { id: 1, char: "ä½ å¥½", pinyin: "nÇ hÇo", english: "Hello", example: "ä½ å¥½ï¼å¾ˆé«˜å…´è§åˆ°ä½ ã€‚", exampleEn: "Hello! Nice to meet you.", hsk: 1, category: "é—®å€™" },
            { id: 2, char: "è°¢è°¢", pinyin: "xiÃ¨xie", english: "Thank you", example: "è°¢è°¢ä½ çš„å¸®åŠ©ï¼", exampleEn: "Thank you for your help!", hsk: 1, category: "ç¤¼è²Œ" },
            { id: 3, char: "å†è§", pinyin: "zÃ ijiÃ n", english: "Goodbye", example: "å†è§ï¼æ˜å¤©è§ã€‚", exampleEn: "Goodbye! See you tomorrow.", hsk: 1, category: "é—®å€™" },
            { id: 4, char: "æ˜¯", pinyin: "shÃ¬", english: "To be (is/am/are)", example: "æˆ‘æ˜¯å­¦ç”Ÿã€‚", exampleEn: "I am a student.", hsk: 1, category: "åŠ¨è¯" },
            { id: 5, char: "æˆ‘", pinyin: "wÇ’", english: "I / me", example: "æˆ‘å–œæ¬¢ä¸­æ–‡ã€‚", exampleEn: "I like Chinese.", hsk: 1, category: "ä»£è¯" },
            { id: 6, char: "ä½ ", pinyin: "nÇ", english: "You", example: "ä½ å«ä»€ä¹ˆåå­—ï¼Ÿ", exampleEn: "What's your name?", hsk: 1, category: "ä»£è¯" },
            { id: 7, char: "ä»–", pinyin: "tÄ", english: "He / him", example: "ä»–æ˜¯æˆ‘çš„æœ‹å‹ã€‚", exampleEn: "He is my friend.", hsk: 1, category: "ä»£è¯" },
            { id: 8, char: "å¥½", pinyin: "hÇo", english: "Good / well", example: "å¤©æ°”å¾ˆå¥½ã€‚", exampleEn: "The weather is very good.", hsk: 1, category: "å½¢å®¹è¯" },
            { id: 9, char: "åƒ", pinyin: "chÄ«", english: "To eat", example: "æˆ‘æƒ³åƒé¥­ã€‚", exampleEn: "I want to eat.", hsk: 1, category: "åŠ¨è¯" },
            { id: 10, char: "å–", pinyin: "hÄ“", english: "To drink", example: "ä½ å–èŒ¶å—ï¼Ÿ", exampleEn: "Do you drink tea?", hsk: 1, category: "åŠ¨è¯" },
            { id: 11, char: "çˆ±", pinyin: "Ã i", english: "To love", example: "æˆ‘çˆ±æˆ‘çš„å®¶äººã€‚", exampleEn: "I love my family.", hsk: 1, category: "åŠ¨è¯" },
            { id: 12, char: "å¤§", pinyin: "dÃ ", english: "Big / large", example: "è¿™ä¸ªæˆ¿é—´å¾ˆå¤§ã€‚", exampleEn: "This room is very big.", hsk: 1, category: "å½¢å®¹è¯" },
            { id: 13, char: "å°", pinyin: "xiÇo", english: "Small / little", example: "æˆ‘æœ‰ä¸€ä¸ªå°å¼Ÿå¼Ÿã€‚", exampleEn: "I have a little brother.", hsk: 1, category: "å½¢å®¹è¯" },
            { id: 14, char: "å¤šå°‘", pinyin: "duÅshao", english: "How many / How much", example: "è¿™ä¸ªå¤šå°‘é’±ï¼Ÿ", exampleEn: "How much is this?", hsk: 1, category: "ç–‘é—®è¯" },
            { id: 15, char: "ä»€ä¹ˆ", pinyin: "shÃ©nme", english: "What", example: "è¿™æ˜¯ä»€ä¹ˆï¼Ÿ", exampleEn: "What is this?", hsk: 1, category: "ç–‘é—®è¯" },

            // HSK 2
            { id: 16, char: "å­¦ä¹ ", pinyin: "xuÃ©xÃ­", english: "To study / learn", example: "æˆ‘åœ¨å­¦ä¹ ä¸­æ–‡ã€‚", exampleEn: "I am studying Chinese.", hsk: 2, category: "åŠ¨è¯" },
            { id: 17, char: "å·¥ä½œ", pinyin: "gÅngzuÃ²", english: "To work / job", example: "ä»–åœ¨å…¬å¸å·¥ä½œã€‚", exampleEn: "He works at a company.", hsk: 2, category: "åŠ¨è¯" },
            { id: 18, char: "æ—¶é—´", pinyin: "shÃ­jiÄn", english: "Time", example: "ç°åœ¨å‡ ç‚¹ï¼Ÿ", exampleEn: "What time is it now?", hsk: 2, category: "åè¯" },
            { id: 19, char: "æœ‹å‹", pinyin: "pÃ©ngyou", english: "Friend", example: "å¥¹æ˜¯æˆ‘çš„å¥½æœ‹å‹ã€‚", exampleEn: "She is my good friend.", hsk: 2, category: "åè¯" },
            { id: 20, char: "é«˜å…´", pinyin: "gÄoxÃ¬ng", english: "Happy / glad", example: "è§åˆ°ä½ å¾ˆé«˜å…´ã€‚", exampleEn: "I'm glad to meet you.", hsk: 2, category: "å½¢å®¹è¯" },
            { id: 21, char: "å¸®åŠ©", pinyin: "bÄngzhÃ¹", english: "To help", example: "è°¢è°¢ä½ çš„å¸®åŠ©ã€‚", exampleEn: "Thank you for your help.", hsk: 2, category: "åŠ¨è¯" },
            { id: 22, char: "é—®é¢˜", pinyin: "wÃ¨ntÃ­", english: "Question / problem", example: "ä½ æœ‰é—®é¢˜å—ï¼Ÿ", exampleEn: "Do you have any questions?", hsk: 2, category: "åè¯" },
            { id: 23, char: "å¼€å§‹", pinyin: "kÄishÇ", english: "To begin / start", example: "æˆ‘ä»¬å¼€å§‹å§ï¼", exampleEn: "Let's start!", hsk: 2, category: "åŠ¨è¯" },
            { id: 24, char: "çŸ¥é“", pinyin: "zhÄ«dÃ o", english: "To know", example: "æˆ‘ä¸çŸ¥é“ç­”æ¡ˆã€‚", exampleEn: "I don't know the answer.", hsk: 2, category: "åŠ¨è¯" },
            { id: 25, char: "è§‰å¾—", pinyin: "juÃ©de", english: "To feel / think", example: "æˆ‘è§‰å¾—å¾ˆç´¯ã€‚", exampleEn: "I feel very tired.", hsk: 2, category: "åŠ¨è¯" },
            { id: 26, char: "å‡†å¤‡", pinyin: "zhÇ”nbÃ¨i", english: "To prepare", example: "æˆ‘åœ¨å‡†å¤‡è€ƒè¯•ã€‚", exampleEn: "I am preparing for the exam.", hsk: 2, category: "åŠ¨è¯" },
            { id: 27, char: "å¼€å¿ƒ", pinyin: "kÄixÄ«n", english: "Happy", example: "ä»Šå¤©æˆ‘å¾ˆå¼€å¿ƒã€‚", exampleEn: "I'm very happy today.", hsk: 2, category: "å½¢å®¹è¯" },
            { id: 28, char: "å®¹æ˜“", pinyin: "rÃ³ngyÃ¬", english: "Easy", example: "ä¸­æ–‡å¾ˆå®¹æ˜“å­¦ã€‚", exampleEn: "Chinese is easy to learn.", hsk: 2, category: "å½¢å®¹è¯" },
            { id: 29, char: "å›°éš¾", pinyin: "kÃ¹nnan", english: "Difficult", example: "è¿™ä¸ªé—®é¢˜å¾ˆå›°éš¾ã€‚", exampleEn: "This problem is very difficult.", hsk: 2, category: "å½¢å®¹è¯" },
            { id: 30, char: "é‡è¦", pinyin: "zhÃ²ngyÃ o", english: "Important", example: "è¿™å¾ˆé‡è¦ã€‚", exampleEn: "This is very important.", hsk: 2, category: "å½¢å®¹è¯" },

            // HSK 3
            { id: 31, char: "åŠªåŠ›", pinyin: "nÇ”lÃ¬", english: "To work hard / effort", example: "ä»–å­¦ä¹ å¾ˆåŠªåŠ›ã€‚", exampleEn: "He studies very hard.", hsk: 3, category: "åŠ¨è¯" },
            { id: 32, char: "æˆåŠŸ", pinyin: "chÃ©nggÅng", english: "Success / to succeed", example: "ç¥ä½ æˆåŠŸï¼", exampleEn: "Wish you success!", hsk: 3, category: "åŠ¨è¯" },
            { id: 33, char: "æœºä¼š", pinyin: "jÄ«huÃ¬", english: "Opportunity / chance", example: "è¿™æ˜¯ä¸€ä¸ªå¥½æœºä¼šã€‚", exampleEn: "This is a good opportunity.", hsk: 3, category: "åè¯" },
            { id: 34, char: "æ–¹ä¾¿", pinyin: "fÄngbiÃ n", english: "Convenient", example: "è¿™é‡Œå¾ˆæ–¹ä¾¿ã€‚", exampleEn: "It's very convenient here.", hsk: 3, category: "å½¢å®¹è¯" },
            { id: 35, char: "äº†è§£", pinyin: "liÇojiÄ›", english: "To understand", example: "æˆ‘äº†è§£ä½ çš„æ„æ€ã€‚", exampleEn: "I understand what you mean.", hsk: 3, category: "åŠ¨è¯" },
            { id: 36, char: "ç»éªŒ", pinyin: "jÄ«ngyÃ n", english: "Experience", example: "ä»–æœ‰å¾ˆå¤šç»éªŒã€‚", exampleEn: "He has a lot of experience.", hsk: 3, category: "åè¯" },
            { id: 37, char: "å½±å“", pinyin: "yÇngxiÇng", english: "Influence / to affect", example: "è¿™å¯¹æˆ‘å½±å“å¾ˆå¤§ã€‚", exampleEn: "This has a big influence on me.", hsk: 3, category: "åŠ¨è¯" },
            { id: 38, char: "å‘å±•", pinyin: "fÄzhÇn", english: "To develop / development", example: "ä¸­å›½å‘å±•å¾ˆå¿«ã€‚", exampleEn: "China is developing very fast.", hsk: 3, category: "åŠ¨è¯" },
            { id: 39, char: "ç¯å¢ƒ", pinyin: "huÃ¡njÃ¬ng", english: "Environment", example: "ä¿æŠ¤ç¯å¢ƒå¾ˆé‡è¦ã€‚", exampleEn: "Protecting the environment is important.", hsk: 3, category: "åè¯" },
            { id: 40, char: "æ€åº¦", pinyin: "tÃ idu", english: "Attitude", example: "ä½ çš„æ€åº¦å¾ˆå¥½ã€‚", exampleEn: "Your attitude is very good.", hsk: 3, category: "åè¯" },

            // HSK 4
            { id: 41, char: "é¼“åŠ±", pinyin: "gÇ”lÃ¬", english: "To encourage", example: "è€å¸ˆé¼“åŠ±æˆ‘ä»¬å­¦ä¹ ã€‚", exampleEn: "The teacher encourages us to study.", hsk: 4, category: "åŠ¨è¯" },
            { id: 42, char: "æ‰¹è¯„", pinyin: "pÄ«pÃ­ng", english: "To criticize", example: "ä¸è¦æ‰¹è¯„åˆ«äººã€‚", exampleEn: "Don't criticize others.", hsk: 4, category: "åŠ¨è¯" },
            { id: 43, char: "å»ºè®®", pinyin: "jiÃ nyÃ¬", english: "Suggestion / to suggest", example: "æˆ‘æœ‰ä¸€ä¸ªå»ºè®®ã€‚", exampleEn: "I have a suggestion.", hsk: 4, category: "åè¯" },
            { id: 44, char: "è´£ä»»", pinyin: "zÃ©rÃ¨n", english: "Responsibility", example: "è¿™æ˜¯æˆ‘çš„è´£ä»»ã€‚", exampleEn: "This is my responsibility.", hsk: 4, category: "åè¯" },
            { id: 45, char: "ä¼˜ç‚¹", pinyin: "yÅudiÇn", english: "Advantage / strong point", example: "ä»–æœ‰å¾ˆå¤šä¼˜ç‚¹ã€‚", exampleEn: "He has many advantages.", hsk: 4, category: "åè¯" },
            { id: 46, char: "ç¼ºç‚¹", pinyin: "quÄ“diÇn", english: "Disadvantage / weakness", example: "æ¯ä¸ªäººéƒ½æœ‰ç¼ºç‚¹ã€‚", exampleEn: "Everyone has weaknesses.", hsk: 4, category: "åè¯" },
            { id: 47, char: "æ•ˆæœ", pinyin: "xiÃ oguÇ’", english: "Effect / result", example: "æ•ˆæœå¾ˆå¥½ã€‚", exampleEn: "The effect is very good.", hsk: 4, category: "åè¯" },
            { id: 48, char: "è¯æ˜", pinyin: "zhÃ¨ngmÃ­ng", english: "To prove / proof", example: "ä½ èƒ½è¯æ˜å—ï¼Ÿ", exampleEn: "Can you prove it?", hsk: 4, category: "åŠ¨è¯" },
            { id: 49, char: "åšæŒ", pinyin: "jiÄnchÃ­", english: "To persist / insist", example: "æˆ‘ä¼šåšæŒå­¦ä¹ ã€‚", exampleEn: "I will persist in studying.", hsk: 4, category: "åŠ¨è¯" },
            { id: 50, char: "åŒ…å«", pinyin: "bÄohÃ¡n", english: "To contain / include", example: "è¿™åŒ…å«å¾ˆå¤šå†…å®¹ã€‚", exampleEn: "This contains a lot of content.", hsk: 4, category: "åŠ¨è¯" }
        ];

        // State Management
        let currentCardIndex = 0;
        let filteredVocab = [...vocabulary];
        let currentHSKFilter = 'all';
        let todayLearned = [];
        let masteredWords = JSON.parse(localStorage.getItem('masteredWords_v2')) || [];
        let streakData = JSON.parse(localStorage.getItem('streakData_v2')) || { count: 0, lastDate: null };
        let quizStats = { correct: 0, wrong: 0 };
        let quizModeStats = JSON.parse(localStorage.getItem('quizModeStats_v2')) || {
            'pinyin-to-char': { correct: 0, wrong: 0 },
            'char-to-pinyin': { correct: 0, wrong: 0 },
            'char-to-english': { correct: 0, wrong: 0 }
        };
        let currentQuizMode = 'pinyin-to-char';
        let dailyGoal = 20;
        let isQuizLocked = false;

        // Initialize
        function init() {
            updateStreakCounter();
            updateStats();
            loadCard();
            checkDailyReset();
        }

        // Check if it's a new day
        function checkDailyReset() {
            const today = new Date().toDateString();
            const lastDate = localStorage.getItem('lastStudyDate_v2');
            
            if (lastDate !== today) {
                todayLearned = [];
                localStorage.setItem('lastStudyDate_v2', today);
                
                // Update streak
                if (lastDate) {
                    const last = new Date(lastDate);
                    const current = new Date(today);
                    const diffDays = Math.floor((current - last) / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 1) {
                        streakData.count++;
                    } else if (diffDays > 1) {
                        streakData.count = 0;
                    }
                } else {
                    streakData.count = 1;
                }
                
                streakData.lastDate = today;
                localStorage.setItem('streakData_v2', JSON.stringify(streakData));
            }
        }

        // Update streak counter
        function updateStreakCounter() {
            document.getElementById('streakCount').textContent = streakData.count;
        }

        // Update statistics
        function updateStats() {
            document.getElementById('todayCount').textContent = todayLearned.length;
            document.getElementById('masteredCount').textContent = masteredWords.length;
            document.getElementById('totalCount').textContent = vocabulary.length;
            document.getElementById('currentProgress').textContent = todayLearned.length;
            document.getElementById('dailyGoal').textContent = dailyGoal;
            
            const progress = Math.min((todayLearned.length / dailyGoal) * 100, 100);
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // Load current card
        function loadCard() {
            if (filteredVocab.length === 0) {
                alert('æ²¡æœ‰æ›´å¤šè¯æ±‡äº†ï¼è¯·æ›´æ”¹ç­›é€‰æ¡ä»¶ã€‚');
                return;
            }
            
            const word = filteredVocab[currentCardIndex];
            document.getElementById('cardCharacter').textContent = word.char;
            document.getElementById('cardPinyin').textContent = word.pinyin;
            document.getElementById('cardEnglish').textContent = word.english;
            document.getElementById('cardExample').textContent = word.example;
            document.getElementById('cardExampleEn').textContent = word.exampleEn;
            document.getElementById('cardHSK').textContent = word.hsk;
            document.getElementById('cardCategory').textContent = word.category;
            
            // Reset flip
            document.getElementById('flashCard').classList.remove('flipped');
        }

        // Flip card
        function flipCard() {
            document.getElementById('flashCard').classList.toggle('flipped');
        }

        // Mark as known
        function markKnown() {
            const word = filteredVocab[currentCardIndex];
            
            if (!masteredWords.includes(word.id)) {
                masteredWords.push(word.id);
                localStorage.setItem('masteredWords_v2', JSON.stringify(masteredWords));
                celebrateSuccess();
            }
            
            if (!todayLearned.includes(word.id)) {
                todayLearned.push(word.id);
            }
            
            nextCard();
        }

        // Mark as difficult
        function markDifficult() {
            const word = filteredVocab[currentCardIndex];
            
            if (!todayLearned.includes(word.id)) {
                todayLearned.push(word.id);
            }
            
            nextCard();
        }

        // Next card
        function nextCard() {
            currentCardIndex = (currentCardIndex + 1) % filteredVocab.length;
            loadCard();
            updateStats();
            
            // Check if reached daily goal
            if (todayLearned.length === dailyGoal) {
                setTimeout(() => {
                    alert('ğŸ‰ æ­å–œï¼ä»Šå¤©çš„å­¦ä¹ ç›®æ ‡è¾¾æˆäº†ï¼');
                    celebrateSuccess();
                }, 300);
            }
        }

        // Celebrate with confetti
        function celebrateSuccess() {
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    createConfetti();
                }, i * 50);
            }
        }

        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.backgroundColor = ['#f87171', '#fbbf24', '#34d399', '#60a5fa', '#a78bfa'][Math.floor(Math.random() * 5)];
            confetti.style.animationDelay = Math.random() * 2 + 's';
            document.body.appendChild(confetti);
            
            setTimeout(() => confetti.remove(), 3000);
        }

        // Filter by HSK level
        function filterByHSK(level) {
            currentHSKFilter = level;
            
            if (level === 'all') {
                filteredVocab = [...vocabulary];
            } else {
                filteredVocab = vocabulary.filter(w => w.hsk == level);
            }
            
            currentCardIndex = 0;
            loadCard();
            
            // Update button styles
            document.querySelectorAll('.hsk-filter').forEach(btn => {
                if (btn.dataset.level === level) {
                    btn.className = 'hsk-filter px-4 py-2 rounded-lg text-sm font-medium transition-all bg-purple-100 text-purple-700';
                } else {
                    btn.className = 'hsk-filter px-4 py-2 rounded-lg text-sm font-medium transition-all bg-gray-100 text-gray-600';
                }
            });
        }

        // Switch tabs
        function switchTab(tab) {
            // Hide all sections
            document.getElementById('learn-section').classList.add('hidden');
            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById('stats-section').classList.add('hidden');
            
            // Show selected section
            document.getElementById(tab + '-section').classList.remove('hidden');
            
            // Update tab styles
            ['learn', 'quiz', 'stats'].forEach(t => {
                const btn = document.getElementById('tab-' + t);
                if (t === tab) {
                    btn.className = 'flex-1 px-6 py-3 rounded-lg font-medium transition-all bg-gradient-to-r from-purple-600 to-pink-600 text-white';
                } else {
                    btn.className = 'flex-1 px-6 py-3 rounded-lg font-medium transition-all text-gray-600 hover:bg-gray-50';
                }
            });
            
            if (tab === 'quiz') {
                loadQuiz();
            } else if (tab === 'stats') {
                renderCharts();
                renderRecentActivity();
            }
        }

        // Set quiz mode
        function setQuizMode(mode) {
            currentQuizMode = mode;
            
            // Update mode button styles
            ['pinyin-to-char', 'char-to-pinyin', 'char-to-english'].forEach(m => {
                const btn = document.getElementById('mode-' + m);
                if (m === mode) {
                    if (m === 'pinyin-to-char') {
                        btn.className = 'mode-badge p-4 rounded-xl border-2 border-purple-200 bg-purple-50 text-purple-700 font-medium transition-all active';
                    } else if (m === 'char-to-pinyin') {
                        btn.className = 'mode-badge p-4 rounded-xl border-2 border-pink-200 bg-pink-50 text-pink-700 font-medium transition-all active';
                    } else {
                        btn.className = 'mode-badge p-4 rounded-xl border-2 border-blue-200 bg-blue-50 text-blue-700 font-medium transition-all active';
                    }
                } else {
                    btn.className = 'mode-badge p-4 rounded-xl border-2 border-gray-200 bg-gray-50 text-gray-600 font-medium transition-all hover:border-gray-300';
                }
            });
            
            loadQuiz();
        }

        // Quiz functionality
        let currentQuizWord = null;

        function loadQuiz() {
            if (isQuizLocked) return;
            
            const randomIndex = Math.floor(Math.random() * filteredVocab.length);
            currentQuizWord = filteredVocab[randomIndex];
            
            let question, correctAnswer, optionPool;
            
            // Set question and answer based on mode
            if (currentQuizMode === 'pinyin-to-char') {
                question = currentQuizWord.pinyin;
                correctAnswer = currentQuizWord.char;
                optionPool = filteredVocab.map(w => w.char);
                document.getElementById('quizModeLabel').textContent = 'çœ‹æ‹¼éŸ³é€‰æ±‰å­—';
                document.getElementById('quizHint').textContent = 'è¯·é€‰æ‹©æ­£ç¡®çš„æ±‰å­—';
            } else if (currentQuizMode === 'char-to-pinyin') {
                question = currentQuizWord.char;
                correctAnswer = currentQuizWord.pinyin;
                optionPool = filteredVocab.map(w => w.pinyin);
                document.getElementById('quizModeLabel').textContent = 'çœ‹æ±‰å­—é€‰æ‹¼éŸ³';
                document.getElementById('quizHint').textContent = 'è¯·é€‰æ‹©æ­£ç¡®çš„æ‹¼éŸ³';
            } else { // char-to-english
                question = currentQuizWord.char;
                correctAnswer = currentQuizWord.english;
                optionPool = filteredVocab.map(w => w.english);
                document.getElementById('quizModeLabel').textContent = 'çœ‹æ±‰å­—é€‰è‹±æ–‡';
                document.getElementById('quizHint').textContent = 'è¯·é€‰æ‹©æ­£ç¡®çš„è‹±æ–‡';
            }
            
            document.getElementById('quizQuestion').textContent = question;
            document.getElementById('quizQuestion').className = currentQuizMode === 'pinyin-to-char' ? 'text-6xl mb-4' : 'text-6xl mb-4 chinese-text';
            
            // Generate options
            const options = [correctAnswer];
            const otherOptions = optionPool.filter(opt => opt !== correctAnswer);
            
            while (options.length < 4 && otherOptions.length > 0) {
                const randomOpt = otherOptions[Math.floor(Math.random() * otherOptions.length)];
                if (!options.includes(randomOpt)) {
                    options.push(randomOpt);
                    otherOptions.splice(otherOptions.indexOf(randomOpt), 1);
                }
            }
            
            // Shuffle options
            options.sort(() => Math.random() - 0.5);
            
            // Render options
            const container = document.getElementById('quizOptions');
            container.innerHTML = '';
            
            options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'quiz-option w-full px-6 py-4 bg-gray-50 hover:bg-gray-100 rounded-xl text-left font-medium transition-all';
                if (currentQuizMode === 'char-to-english') {
                    btn.textContent = option;
                } else {
                    btn.className += ' chinese-text text-lg';
                    btn.textContent = option;
                }
                btn.onclick = () => checkQuizAnswer(option, btn, correctAnswer);
                container.appendChild(btn);
            });
        }

        function checkQuizAnswer(selected, button, correctAnswer) {
            if (isQuizLocked) return;
            isQuizLocked = true;
            
            const correct = selected === correctAnswer;
            
            if (correct) {
                button.className = button.className.replace('bg-gray-50', '').replace('hover:bg-gray-100', '') + ' correct-answer';
                quizStats.correct++;
                quizModeStats[currentQuizMode].correct++;
            } else {
                button.className = button.className.replace('bg-gray-50', '').replace('hover:bg-gray-100', '') + ' wrong-answer';
                quizStats.wrong++;
                quizModeStats[currentQuizMode].wrong++;
                
                // Show correct answer
                setTimeout(() => {
                    const buttons = document.querySelectorAll('.quiz-option');
                    buttons.forEach(btn => {
                        if (btn.textContent === correctAnswer) {
                            btn.className = btn.className.replace('bg-gray-50', '').replace('hover:bg-gray-100', '') + ' correct-answer';
                        }
                    });
                }, 500);
            }
            
            // Save mode stats
            localStorage.setItem('quizModeStats_v2', JSON.stringify(quizModeStats));
            
            // Update stats
            updateQuizStats();
            
            // Load next question
            setTimeout(() => {
                isQuizLocked = false;
                loadQuiz();
            }, 1500);
        }

        function updateQuizStats() {
            document.getElementById('quizCorrect').textContent = quizStats.correct;
            document.getElementById('quizWrong').textContent = quizStats.wrong;
            
            const total = quizStats.correct + quizStats.wrong;
            const accuracy = total > 0 ? Math.round((quizStats.correct / total) * 100) : 0;
            document.getElementById('quizAccuracy').textContent = accuracy + '%';
        }

        // Render charts
        function renderCharts() {
            // Progress chart
            const ctx1 = document.getElementById('progressChart');
            if (ctx1) {
                new Chart(ctx1.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'],
                        datasets: [{
                            label: 'å­¦ä¹ è¯æ±‡æ•°',
                            data: [12, 19, 15, 25, 22, 30, todayLearned.length],
                            borderColor: '#a855f7',
                            backgroundColor: 'rgba(168, 85, 247, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }
            
            // HSK distribution chart
            const hskCounts = { 1: 0, 2: 0, 3: 0, 4: 0 };
            masteredWords.forEach(id => {
                const word = vocabulary.find(w => w.id === id);
                if (word) hskCounts[word.hsk]++;
            });
            
            const ctx2 = document.getElementById('hskChart');
            if (ctx2) {
                new Chart(ctx2.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['HSK 1', 'HSK 2', 'HSK 3', 'HSK 4'],
                        datasets: [{
                            data: Object.values(hskCounts),
                            backgroundColor: ['#f87171', '#fbbf24', '#34d399', '#60a5fa']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Quiz mode performance chart
            const ctx3 = document.getElementById('modeChart');
            if (ctx3) {
                const modeData = [
                    quizModeStats['pinyin-to-char'].correct,
                    quizModeStats['char-to-pinyin'].correct,
                    quizModeStats['char-to-english'].correct
                ];
                
                new Chart(ctx3.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['æ‹¼éŸ³â†’æ±‰å­—', 'æ±‰å­—â†’æ‹¼éŸ³', 'æ±‰å­—â†’è‹±æ–‡'],
                        datasets: [{
                            label: 'ç­”å¯¹é¢˜æ•°',
                            data: modeData,
                            backgroundColor: ['#a855f7', '#ec4899', '#3b82f6'],
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }
        }

        // Render recent activity
        function renderRecentActivity() {
            const container = document.getElementById('recentActivity');
            container.innerHTML = '';
            
            const recentWords = masteredWords.slice(-10).reverse();
            
            recentWords.forEach(id => {
                const word = vocabulary.find(w => w.id === id);
                if (!word) return;
                
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                item.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="text-2xl chinese-text">${word.char}</div>
                        <div>
                            <div class="text-sm font-medium">${word.pinyin}</div>
                            <div class="text-xs text-gray-500">${word.english}</div>
                        </div>
                    </div>
                    <div class="text-xs text-gray-400">HSK ${word.hsk}</div>
                `;
                container.appendChild(item);
            });
            
            if (recentWords.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-400 py-8">è¿˜æ²¡æœ‰å­¦ä¹ è®°å½•</p>';
            }
        }

        // Initialize app
        init();
    </script>
</body>
</html>
